```agda
open import 1Lab.Prelude
open import Algebra.Ring

module Foundations.Smooth {ℓ} (R : Ring ℓ)  where
```

# Synthetic Smoothness

Synthetic Differential Geometry is a field of mathematics founded in the
70s, based on the idea of replacing the epsilon-delta reasoning of
classical analysis with reasoning directly with infinitesimals. A
textbook on the theory is available [here].

[here]: https://users-math.au.dk/kock/sdg99.pdf

<--
```agda
module R = Ring-on (R .snd)
|R| = R .fst
0R = R.unit
1R = R.1R
_+R_ = R._+_
infixl 6 _+R_
_*R_ = R._*_
infixl 7 _*R_
```
-->

The most basic infinitesimal object is the set of nilsquares (numbers
which square to zero) $D$. $D$ is an infinitesimally small line segment,
too small to bend but nontheless nontrivial.

```agda
is-nilsquare : |R| → Type ℓ
is-nilsquare r =  r *R r ≡ 0R

Nilsquares = Σ |R| is-nilsquare

postulate
  0*0=0 : 0R *R 0R ≡ 0R
  -- I don't want to prove this right now.

0nil : Nilsquares
0nil = (0R , 0*0=0)
```



```agda
Basic-Koch-Lawvere : Type ℓ
Basic-Koch-Lawvere = (f : Nilsquares → |R|) → is-contr ( Σ[ x ∈ |R| ] (
                            (ε : Nilsquares) → f ε ≡ f 0nil +R x *R (ε .fst) ))
```

This lets us define the derivative of an arbitrary function $R → R$ and
get another function $R → R$, which is defined everywhere. From this,
we get that all functions are infinitely differentiable.

```agda
derivative : Basic-Koch-Lawvere → (|R| → |R|) → |R| → |R|
derivative axiom f x = axiom (λ d → f (d .fst)) .centre .fst
```

<--
We could also prove a bunch of standard results about derivatives, but I
want to wait for a ring solver before trying, because otherwise it
sounds painful.
-->


<--
unusued, I should yeet it before commiting, but I should also show that
`Basic-Koch-Lawvere ≡ is-equiv nilsquare-affine` eventually.
```agda
nilsquare-affine : (|R| × |R|) → Nilsquares → |R|
nilsquare-affine (c , m) x = m *R (x .fst) +R c
```
-->

<--
Eventually, we want to write up all of the basic axioms of SDG. The most
importnat family of these is, for a finitely presented R-algebra A, we
ask the R-algebra homomorphism _ : A → (R-alg-hom(A,R) → R) to be
an equivalence.

Axiom 1'' of the reference is equivalent to allowing the A to range over
the algebras generated by m numbers, any k of which multiply to 0.

Axiom 1W also presupposes that R is a k-algebra, and asks that for any
k-algebra structure A' on k^n, R(x)A' satisfies it.

Axiom 2 permits any finitely presented k-algebra instead in 1W, and
is much stronger - k[x] already lets you prove that all functions
R → R are polynomial.

There is a canonical choice for k in the above axioms - ♭R. The use of
the ♭ modality is natural, due to its presence on the statement of
Axiom 3 - for any A' as in Axiom 3, the functor R-alg-hom(A,R) → has a
right adjoint as an endofunctor on the category with objects as sets and
morphisms C → B as ♭(C → B).
-->
